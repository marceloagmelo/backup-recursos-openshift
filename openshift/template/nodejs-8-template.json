{"kind":"Template","apiVersion":"template.openshift.io/v1","metadata":{"name":"nodejs-8-template","namespace":"openshift","selfLink":"/apis/template.openshift.io/v1/namespaces/openshift/templates/nodejs-8-template","uid":"1cb63f03-a741-11e9-a846-42010a9e0002","resourceVersion":"22158","creationTimestamp":"2019-07-15T20:42:50Z","annotations":{"description":"Template para deploy Nodejs (BR)","iconClass":"icon-nodejs","kubectl.kubernetes.io/last-applied-configuration":"{\"apiVersion\":\"template.openshift.io/v1\",\"kind\":\"Template\",\"labels\":{\"template\":\"nodejs-8-template\"},\"metadata\":{\"annotations\":{\"description\":\"Template para deploy Nodejs (BR)\",\"iconClass\":\"icon-nodejs\",\"openshift.io/display-name\":\"Nodejs 8 (BR)\",\"openshift.io/documentation-url\":\"https://gitlab.produbanbr.corp/paas-brasil/openshift-templates\",\"openshift.io/provider-display-name\":\"Santander Tecnologia - PaaS Brasil.\",\"tags\":\"quickstart,nodejs\",\"template.openshift.io/bindable\":\"false\"},\"name\":\"nodejs-8-template\",\"namespace\":\"openshift\"},\"objects\":[{\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"labels\":{\"app_name\":\"${APP_NAME}\",\"template\":\"nodejs-8\"},\"name\":\"${APP_NAME}\"},\"spec\":{\"ports\":[{\"name\":\"8080-tcp\",\"nodePort\":0,\"port\":8080,\"protocol\":\"TCP\",\"targetPort\":8080}],\"selector\":{\"app_name\":\"${APP_NAME}\",\"deploymentconfig\":\"${APP_NAME}\"},\"sessionAffinity\":\"None\",\"type\":\"ClusterIP\"},\"status\":{\"loadBalancer\":{}}},{\"apiVersion\":\"v1\",\"kind\":\"Route\",\"metadata\":{\"annotations\":{\"haproxy.router.openshift.io/balance\":\"roundrobin\"},\"labels\":{\"app_name\":\"${APP_NAME}\",\"template\":\"nodejs-8\"},\"name\":\"vs-${APP_NAME}\"},\"spec\":{\"port\":{\"targetPort\":\"8080-tcp\"},\"tls\":{\"termination\":\"edge\"},\"to\":{\"kind\":\"Service\",\"name\":\"${APP_NAME}\"}},\"status\":{}},{\"apiVersion\":\"v1\",\"kind\":\"BuildConfig\",\"metadata\":{\"annotations\":{\"description\":\"Defines pipeline the application\"},\"labels\":{\"app_name\":\"${APP_NAME}\",\"template\":\"nodejs-8\"},\"name\":\"${APP_NAME}-pipeline\"},\"spec\":{\"output\":{},\"strategy\":{\"jenkinsPipelineStrategy\":{\"jenkinsfile\":\"try {\\n   timeout(time: 20, unit: 'MINUTES') {\\n      node('nodejs') {\\n          stage('build') {\\n            openshift.withCluster() {\\n               openshift.withProject() {\\n                  def bld = openshift.startBuild('nodemysql')\\n                  bld.untilEach {\\n                    return it.object().status.phase == \\\"Running\\\"\\n                  }\\n                  bld.logs('-f')\\n               }  \\n            }\\n          }\\n          stage('deploy') {\\n            openshift.withCluster() {\\n              openshift.withProject() {\\n                def dc = openshift.selector('dc', 'nodemysql')\\n                dc.rollout().latest()\\n              }\\n            }\\n          }\\n        }\\n   }\\n} catch (err) {\\n   echo \\\"in catch block\\\"\\n   echo \\\"Caught: ${err}\\\"\\n   currentBuild.result = 'FAILURE'\\n   throw err\\n}\"},\"type\":\"JenkinsPipeline\"},\"triggers\":[{\"github\":{\"secret\":\"${GITHUB_WEBHOOK_SECRET}\"},\"type\":\"GitHub\"},{\"generic\":{\"secret\":\"${GENERIC_WEBHOOK_SECRET}\"},\"type\":\"Generic\"}]}},{\"apiVersion\":\"v1\",\"kind\":\"ImageStream\",\"metadata\":{\"annotations\":{\"description\":\"Keeps track of changes in the application image\"},\"labels\":{\"app_name\":\"${APP_NAME}\"},\"name\":\"${APP_NAME}\"}},{\"apiVersion\":\"v1\",\"kind\":\"BuildConfig\",\"metadata\":{\"annotations\":{\"description\":\"Defines how to build the application\"},\"labels\":{\"app_name\":\"${APP_NAME}\"},\"name\":\"${APP_NAME}\"},\"spec\":{\"output\":{\"to\":{\"kind\":\"ImageStreamTag\",\"name\":\"${APP_NAME}:latest\"}},\"source\":{\"contextDir\":\"${CONTEXT_DIR}\",\"git\":{\"ref\":\"${SOURCE_REPOSITORY_REF}\",\"uri\":\"${SOURCE_REPOSITORY_URL}\"},\"type\":\"Git\"},\"strategy\":{\"dockerStrategy\":{\"env\":[{\"name\":\"SOURCE_REPOSITORY_URL\",\"value\":\"${SOURCE_REPOSITORY_URL}\"},{\"name\":\"SOURCE_REPOSITORY_REF\",\"value\":\"${SOURCE_REPOSITORY_REF}\"},{\"name\":\"CONTEXT_DIR\",\"value\":\"${CONTEXT_DIR}\"},{\"name\":\"http_proxy\",\"value\":\"${http_proxy}\"},{\"name\":\"https_proxy\",\"value\":\"${https_proxy}\"}],\"from\":{\"kind\":\"DockerImage\",\"name\":\"${IMAGE_NAME}:${IMAGE_VERSION}\"}},\"type\":\"Docker\"},\"triggers\":[{\"type\":\"ImageChange\"},{\"type\":\"ConfigChange\"},{\"github\":{\"secret\":\"${GITHUB_WEBHOOK_SECRET}\"},\"type\":\"GitHub\"},{\"generic\":{\"secret\":\"${GENERIC_WEBHOOK_SECRET}\"},\"type\":\"Generic\"}]}},{\"apiVersion\":\"v1\",\"kind\":\"DeploymentConfig\",\"metadata\":{\"labels\":{\"app_name\":\"${APP_NAME}\",\"technology\":\"nodejs-8\"},\"name\":\"${APP_NAME}\"},\"spec\":{\"replicas\":1,\"revisionHistoryLimit\":10,\"selector\":{\"app_name\":\"${APP_NAME}\",\"deploymentconfig\":\"${APP_NAME}\"},\"strategy\":{\"resources\":{},\"rollingParams\":{\"intervalSeconds\":1,\"maxUnavailable\":0,\"timeoutSeconds\":600,\"updatePeriodSeconds\":1},\"type\":\"Rolling\"},\"template\":{\"metadata\":{\"labels\":{\"app_name\":\"${APP_NAME}\",\"deploymentconfig\":\"${APP_NAME}\"}},\"spec\":{\"containers\":[{\"env\":[{\"name\":\"APP_NAME\",\"value\":\"${APP_NAME}\"},{\"name\":\"PROJECT_NAME\",\"valueFrom\":{\"fieldRef\":{\"fieldPath\":\"metadata.namespace\"}}},{\"name\":\"NODE_PATH\",\"value\":\"${NODE_PATH}\"},{\"name\":\"NPM_REGISTRY\",\"value\":\"${NPM_REGISTRY}\"},{\"name\":\"NPM_LOGLEVEL\",\"value\":\"${NPM_LOGLEVEL}\"},{\"name\":\"TZ\",\"value\":\"${TZ}\"}],\"image\":\"\",\"imagePullPolicy\":\"IfNotPresent\",\"livenessProbe\":{\"httpGet\":{\"path\":\"/\",\"port\":8080},\"initialDelaySeconds\":15,\"timeoutSeconds\":30},\"name\":\"${APP_NAME}\",\"ports\":[{\"containerPort\":8080,\"protocol\":\"TCP\"}],\"readinessProbe\":{\"httpGet\":{\"path\":\"/\",\"port\":8080},\"initialDelaySeconds\":15,\"timeoutSeconds\":30},\"resources\":{\"limits\":{\"cpu\":1,\"memory\":\"1G\"},\"requests\":{\"cpu\":\"1m\",\"memory\":\"256M\"}},\"securityContext\":{\"capabilities\":{},\"privileged\":false},\"terminationMessagePath\":\"/dev/termination-log\",\"volumeMounts\":[{\"mountPath\":\"/opt/metadata\",\"name\":\"podinfo\",\"readOnly\":false}]}],\"dnsPolicy\":\"ClusterFirst\",\"restartPolicy\":\"Always\",\"securityContext\":{\"supplementalGroups\":[65534]},\"volumes\":[{\"metadata\":{\"items\":[{\"fieldRef\":{\"fieldPath\":\"metadata.labels\"},\"name\":\"labels\"},{\"fieldRef\":{\"fieldPath\":\"metadata.annotations\"},\"name\":\"annotations\"}]},\"name\":\"podinfo\"}]}},\"triggers\":[{\"imageChangeParams\":{\"automatic\":true,\"containerNames\":[\"${APP_NAME}\"],\"from\":{\"kind\":\"ImageStream\",\"name\":\"${APP_NAME}:latest\"}},\"type\":\"ImageChange\"}]},\"status\":{}}],\"parameters\":[{\"description\":\"Application name\",\"displayName\":\"Application Name\",\"name\":\"APP_NAME\",\"required\":true},{\"description\":\"The URL of the repository with your application source code.\",\"displayName\":\"Git Repository URL\",\"name\":\"SOURCE_REPOSITORY_URL\",\"value\":\"https://GIT_HOST/GIT_GROUP/GIT_PROJECT.git\"},{\"description\":\"Set this to a branch name, tag or other ref of your repository if you are not using the default branch.\",\"displayName\":\"Git Reference\",\"name\":\"SOURCE_REPOSITORY_REF\"},{\"description\":\"Set this to the relative path to your project if it is not in the root of your repository.\",\"displayName\":\"Context Directory\",\"name\":\"CONTEXT_DIR\",\"value\":\"\"},{\"description\":\"A secret string used to configure the GitHub webhook.\",\"displayName\":\"GitHub Webhook Secret\",\"from\":\"[a-zA-Z0-9]{40}\",\"generate\":\"expression\",\"name\":\"GITHUB_WEBHOOK_SECRET\"},{\"description\":\"A secret string used to configure the Generic webhook.\",\"displayName\":\"Generic Webhook Secret\",\"from\":\"[a-zA-Z0-9]{40}\",\"generate\":\"expression\",\"name\":\"GENERIC_WEBHOOK_SECRET\"},{\"description\":\"Image name\",\"displayName\":\"Image Name\",\"name\":\"IMAGE_NAME\",\"required\":true,\"value\":\"marceloagmelo/s2i-nodejs-8\"},{\"description\":\"Image version\",\"displayName\":\"Image version\",\"name\":\"IMAGE_VERSION\",\"required\":true,\"value\":\"1.0.0.RELEASE\"},{\"description\":\"Path to the app root's folder\",\"displayName\":\"Path to the app root's folder\",\"name\":\"NODE_PATH\"},{\"description\":\"The JavaScripts Package Registry.\",\"displayName\":\"Npm registry\",\"name\":\"NPM_REGISTRY\",\"value\":\"https://nexus.ci.gsnet.corp/nexus/content/groups/npm-all/\"},{\"description\":\"silent, error, warn, http, info, verbose, silly\",\"displayName\":\"npm - What level of logs to report\",\"name\":\"NPM_LOGLEVEL\",\"value\":\"info\"},{\"description\":\"TimeZone for the running containers.\",\"displayName\":\"TimeZone\",\"name\":\"TZ\",\"value\":\"America/Sao_Paulo\"}]}\n","openshift.io/display-name":"Nodejs 8 (BR)","openshift.io/documentation-url":"https://gitlab.produbanbr.corp/paas-brasil/openshift-templates","openshift.io/provider-display-name":"Santander Tecnologia - PaaS Brasil.","tags":"quickstart,nodejs","template.openshift.io/bindable":"false"}},"objects":[{"apiVersion":"v1","kind":"Service","metadata":{"labels":{"app_name":"${APP_NAME}","template":"nodejs-8"},"name":"${APP_NAME}"},"spec":{"ports":[{"name":"8080-tcp","nodePort":0,"port":8080,"protocol":"TCP","targetPort":8080}],"selector":{"app_name":"${APP_NAME}","deploymentconfig":"${APP_NAME}"},"sessionAffinity":"None","type":"ClusterIP"},"status":{"loadBalancer":{}}},{"apiVersion":"v1","kind":"Route","metadata":{"annotations":{"haproxy.router.openshift.io/balance":"roundrobin"},"labels":{"app_name":"${APP_NAME}","template":"nodejs-8"},"name":"vs-${APP_NAME}"},"spec":{"port":{"targetPort":"8080-tcp"},"tls":{"termination":"edge"},"to":{"kind":"Service","name":"${APP_NAME}"}},"status":{}},{"apiVersion":"v1","kind":"BuildConfig","metadata":{"annotations":{"description":"Defines pipeline the application"},"labels":{"app_name":"${APP_NAME}","template":"nodejs-8"},"name":"${APP_NAME}-pipeline"},"spec":{"output":{},"strategy":{"jenkinsPipelineStrategy":{"jenkinsfile":"try {\n   timeout(time: 20, unit: 'MINUTES') {\n      node('nodejs') {\n          stage('build') {\n            openshift.withCluster() {\n               openshift.withProject() {\n                  def bld = openshift.startBuild('nodemysql')\n                  bld.untilEach {\n                    return it.object().status.phase == \"Running\"\n                  }\n                  bld.logs('-f')\n               }  \n            }\n          }\n          stage('deploy') {\n            openshift.withCluster() {\n              openshift.withProject() {\n                def dc = openshift.selector('dc', 'nodemysql')\n                dc.rollout().latest()\n              }\n            }\n          }\n        }\n   }\n} catch (err) {\n   echo \"in catch block\"\n   echo \"Caught: ${err}\"\n   currentBuild.result = 'FAILURE'\n   throw err\n}"},"type":"JenkinsPipeline"},"triggers":[{"github":{"secret":"${GITHUB_WEBHOOK_SECRET}"},"type":"GitHub"},{"generic":{"secret":"${GENERIC_WEBHOOK_SECRET}"},"type":"Generic"}]}},{"apiVersion":"v1","kind":"ImageStream","metadata":{"annotations":{"description":"Keeps track of changes in the application image"},"labels":{"app_name":"${APP_NAME}"},"name":"${APP_NAME}"}},{"apiVersion":"v1","kind":"BuildConfig","metadata":{"annotations":{"description":"Defines how to build the application"},"labels":{"app_name":"${APP_NAME}"},"name":"${APP_NAME}"},"spec":{"output":{"to":{"kind":"ImageStreamTag","name":"${APP_NAME}:latest"}},"source":{"contextDir":"${CONTEXT_DIR}","git":{"ref":"${SOURCE_REPOSITORY_REF}","uri":"${SOURCE_REPOSITORY_URL}"},"type":"Git"},"strategy":{"dockerStrategy":{"env":[{"name":"SOURCE_REPOSITORY_URL","value":"${SOURCE_REPOSITORY_URL}"},{"name":"SOURCE_REPOSITORY_REF","value":"${SOURCE_REPOSITORY_REF}"},{"name":"CONTEXT_DIR","value":"${CONTEXT_DIR}"},{"name":"http_proxy","value":"${http_proxy}"},{"name":"https_proxy","value":"${https_proxy}"}],"from":{"kind":"DockerImage","name":"${IMAGE_NAME}:${IMAGE_VERSION}"}},"type":"Docker"},"triggers":[{"type":"ImageChange"},{"type":"ConfigChange"},{"github":{"secret":"${GITHUB_WEBHOOK_SECRET}"},"type":"GitHub"},{"generic":{"secret":"${GENERIC_WEBHOOK_SECRET}"},"type":"Generic"}]}},{"apiVersion":"v1","kind":"DeploymentConfig","metadata":{"labels":{"app_name":"${APP_NAME}","technology":"nodejs-8"},"name":"${APP_NAME}"},"spec":{"replicas":1,"revisionHistoryLimit":10,"selector":{"app_name":"${APP_NAME}","deploymentconfig":"${APP_NAME}"},"strategy":{"resources":{},"rollingParams":{"intervalSeconds":1,"maxUnavailable":0,"timeoutSeconds":600,"updatePeriodSeconds":1},"type":"Rolling"},"template":{"metadata":{"labels":{"app_name":"${APP_NAME}","deploymentconfig":"${APP_NAME}"}},"spec":{"containers":[{"env":[{"name":"APP_NAME","value":"${APP_NAME}"},{"name":"PROJECT_NAME","valueFrom":{"fieldRef":{"fieldPath":"metadata.namespace"}}},{"name":"NODE_PATH","value":"${NODE_PATH}"},{"name":"NPM_REGISTRY","value":"${NPM_REGISTRY}"},{"name":"NPM_LOGLEVEL","value":"${NPM_LOGLEVEL}"},{"name":"TZ","value":"${TZ}"}],"image":"","imagePullPolicy":"IfNotPresent","livenessProbe":{"httpGet":{"path":"/","port":8080},"initialDelaySeconds":15,"timeoutSeconds":30},"name":"${APP_NAME}","ports":[{"containerPort":8080,"protocol":"TCP"}],"readinessProbe":{"httpGet":{"path":"/","port":8080},"initialDelaySeconds":15,"timeoutSeconds":30},"resources":{"limits":{"cpu":1,"memory":"1G"},"requests":{"cpu":"1m","memory":"256M"}},"securityContext":{"capabilities":{},"privileged":false},"terminationMessagePath":"/dev/termination-log","volumeMounts":[{"mountPath":"/opt/metadata","name":"podinfo","readOnly":false}]}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","securityContext":{"supplementalGroups":[65534]},"volumes":[{"metadata":{"items":[{"fieldRef":{"fieldPath":"metadata.labels"},"name":"labels"},{"fieldRef":{"fieldPath":"metadata.annotations"},"name":"annotations"}]},"name":"podinfo"}]}},"triggers":[{"imageChangeParams":{"automatic":true,"containerNames":["${APP_NAME}"],"from":{"kind":"ImageStream","name":"${APP_NAME}:latest"}},"type":"ImageChange"}]},"status":{}}],"parameters":[{"name":"APP_NAME","displayName":"Application Name","description":"Application name","required":true},{"name":"SOURCE_REPOSITORY_URL","displayName":"Git Repository URL","description":"The URL of the repository with your application source code.","value":"https://GIT_HOST/GIT_GROUP/GIT_PROJECT.git"},{"name":"SOURCE_REPOSITORY_REF","displayName":"Git Reference","description":"Set this to a branch name, tag or other ref of your repository if you are not using the default branch."},{"name":"CONTEXT_DIR","displayName":"Context Directory","description":"Set this to the relative path to your project if it is not in the root of your repository."},{"name":"GITHUB_WEBHOOK_SECRET","displayName":"GitHub Webhook Secret","description":"A secret string used to configure the GitHub webhook.","generate":"expression","from":"[a-zA-Z0-9]{40}"},{"name":"GENERIC_WEBHOOK_SECRET","displayName":"Generic Webhook Secret","description":"A secret string used to configure the Generic webhook.","generate":"expression","from":"[a-zA-Z0-9]{40}"},{"name":"IMAGE_NAME","displayName":"Image Name","description":"Image name","value":"marceloagmelo/s2i-nodejs-8","required":true},{"name":"IMAGE_VERSION","displayName":"Image version","description":"Image version","value":"1.0.0.RELEASE","required":true},{"name":"NODE_PATH","displayName":"Path to the app root's folder","description":"Path to the app root's folder"},{"name":"NPM_REGISTRY","displayName":"Npm registry","description":"The JavaScripts Package Registry.","value":"https://nexus.ci.gsnet.corp/nexus/content/groups/npm-all/"},{"name":"NPM_LOGLEVEL","displayName":"npm - What level of logs to report","description":"silent, error, warn, http, info, verbose, silly","value":"info"},{"name":"TZ","displayName":"TimeZone","description":"TimeZone for the running containers.","value":"America/Sao_Paulo"}],"labels":{"template":"nodejs-8-template"}}
