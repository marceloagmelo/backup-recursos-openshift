{"kind":"DaemonSet","apiVersion":"extensions/v1beta1","metadata":{"name":"ovs","namespace":"openshift-sdn","selfLink":"/apis/extensions/v1beta1/namespaces/openshift-sdn/daemonsets/ovs","uid":"a396ccad-a715-11e9-9411-42010a9e0002","resourceVersion":"366894","generation":2,"creationTimestamp":"2019-07-15T15:31:39Z","labels":{"app":"ovs","component":"network","openshift.io/component":"network","type":"infra"},"annotations":{"image.openshift.io/triggers":"[{\"from\":{\"kind\":\"ImageStreamTag\",\"name\":\"node:v3.11\"},\"fieldPath\":\"spec.template.spec.containers[?(@.name==\\\"openvswitch\\\")].image\"}]\n","kubectl.kubernetes.io/last-applied-configuration":"{\"apiVersion\":\"apps/v1\",\"kind\":\"DaemonSet\",\"metadata\":{\"annotations\":{\"image.openshift.io/triggers\":\"[{\\\"from\\\":{\\\"kind\\\":\\\"ImageStreamTag\\\",\\\"name\\\":\\\"node:v3.11\\\"},\\\"fieldPath\\\":\\\"spec.template.spec.containers[?(@.name==\\\\\\\"openvswitch\\\\\\\")].image\\\"}]\\n\",\"kubernetes.io/description\":\"This daemon set launches the openvswitch daemon.\\n\"},\"name\":\"ovs\",\"namespace\":\"openshift-sdn\"},\"spec\":{\"selector\":{\"matchLabels\":{\"app\":\"ovs\"}},\"template\":{\"metadata\":{\"annotations\":{\"scheduler.alpha.kubernetes.io/critical-pod\":\"\"},\"labels\":{\"app\":\"ovs\",\"component\":\"network\",\"openshift.io/component\":\"network\",\"type\":\"infra\"}},\"spec\":{\"containers\":[{\"command\":[\"/bin/bash\",\"-c\",\"#!/bin/bash\\nset -euo pipefail\\n\\n# cleanup old log files\\nrm -f /var/log/openvswitch-old/ovsdb-server.log /var/log/openvswitch-old/ovs-vswitchd.log\\n\\nmkdir -p /var/log/openvswitch\\n\\n# if another process is listening on the cni-server socket, wait until it exits\\ntrap 'kill $(jobs -p); exit 0' TERM\\nretries=0\\nwhile true; do\\n  if /usr/share/openvswitch/scripts/ovs-ctl status \\u0026\\u003e/dev/null; then\\n    echo \\\"warning: Another process is currently managing OVS, waiting 15s ...\\\" 2\\u003e\\u00261\\n    sleep 15 \\u0026 wait\\n    (( retries += 1 ))\\n  else\\n    break\\n  fi\\n  if [[ \\\"${retries}\\\" -gt 40 ]]; then\\n    echo \\\"error: Another process is currently managing OVS, exiting\\\" 2\\u003e\\u00261\\n    exit 1\\n  fi\\ndone\\n\\n# launch OVS\\nfunction quit {\\n    /usr/share/openvswitch/scripts/ovs-ctl stop\\n    exit 0\\n}\\ntrap quit SIGTERM\\n/usr/share/openvswitch/scripts/ovs-ctl start --no-ovs-vswitchd --system-id=random\\n\\n# Restrict the number of pthreads ovs-vswitchd creates to reduce the\\n# amount of RSS it uses on hosts with many cores\\n# https://bugzilla.redhat.com/show_bug.cgi?id=1571379\\n# https://bugzilla.redhat.com/show_bug.cgi?id=1572797\\nif [[ `nproc` -gt 12 ]]; then\\n    ovs-vsctl --no-wait set Open_vSwitch . other_config:n-revalidator-threads=4\\n    ovs-vsctl --no-wait set Open_vSwitch . other_config:n-handler-threads=10\\nfi\\n/usr/share/openvswitch/scripts/ovs-ctl start --no-ovsdb-server --system-id=random\\n\\ntail --follow=name /var/log/openvswitch/ovs-vswitchd.log /var/log/openvswitch/ovsdb-server.log \\u0026\\nsleep 20\\nwhile true; do\\n  if ! /usr/share/openvswitch/scripts/ovs-ctl status \\u0026\\u003e/dev/null; then\\n    echo \\\"OVS seems to have crashed, exiting\\\"\\n    quit\\n  fi\\n  sleep 15\\ndone\\n\"],\"image\":\" \",\"livenessProbe\":{\"exec\":{\"command\":[\"/usr/share/openvswitch/scripts/ovs-ctl\",\"status\"]},\"initialDelaySeconds\":15,\"periodSeconds\":5},\"name\":\"openvswitch\",\"resources\":{\"requests\":{\"cpu\":\"100m\",\"memory\":\"300Mi\"}},\"securityContext\":{\"privileged\":true,\"runAsUser\":0},\"volumeMounts\":[{\"mountPath\":\"/lib/modules\",\"name\":\"host-modules\",\"readOnly\":true},{\"mountPath\":\"/run/openvswitch\",\"name\":\"host-run-ovs\"},{\"mountPath\":\"/var/run/openvswitch\",\"name\":\"host-run-ovs\"},{\"mountPath\":\"/sys\",\"name\":\"host-sys\",\"readOnly\":true},{\"mountPath\":\"/etc/openvswitch\",\"name\":\"host-config-openvswitch\"},{\"mountPath\":\"/var/log/openvswitch-old\",\"name\":\"log-openvswitch\"}]}],\"hostNetwork\":true,\"hostPID\":true,\"priorityClassName\":\"system-node-critical\",\"serviceAccountName\":\"sdn\",\"tolerations\":[{\"operator\":\"Exists\"}],\"volumes\":[{\"hostPath\":{\"path\":\"/lib/modules\"},\"name\":\"host-modules\"},{\"hostPath\":{\"path\":\"/run/openvswitch\"},\"name\":\"host-run-ovs\"},{\"hostPath\":{\"path\":\"/sys\"},\"name\":\"host-sys\"},{\"hostPath\":{\"path\":\"/etc/origin/openvswitch\"},\"name\":\"host-config-openvswitch\"},{\"hostPath\":{\"path\":\"/var/log/openvswitch\",\"type\":\"DirectoryOrCreate\"},\"name\":\"log-openvswitch\"}]}},\"updateStrategy\":{\"type\":\"OnDelete\"}}}\n","kubernetes.io/description":"This daemon set launches the openvswitch daemon.\n"}},"spec":{"selector":{"matchLabels":{"app":"ovs"}},"template":{"metadata":{"creationTimestamp":null,"labels":{"app":"ovs","component":"network","openshift.io/component":"network","type":"infra"},"annotations":{"scheduler.alpha.kubernetes.io/critical-pod":""}},"spec":{"volumes":[{"name":"host-modules","hostPath":{"path":"/lib/modules","type":""}},{"name":"host-run-ovs","hostPath":{"path":"/run/openvswitch","type":""}},{"name":"host-sys","hostPath":{"path":"/sys","type":""}},{"name":"host-config-openvswitch","hostPath":{"path":"/etc/origin/openvswitch","type":""}},{"name":"log-openvswitch","hostPath":{"path":"/var/log/openvswitch","type":"DirectoryOrCreate"}}],"containers":[{"name":"openvswitch","image":"docker.io/openshift/origin-node:v3.11","command":["/bin/bash","-c","#!/bin/bash\nset -euo pipefail\n\n# cleanup old log files\nrm -f /var/log/openvswitch-old/ovsdb-server.log /var/log/openvswitch-old/ovs-vswitchd.log\n\nmkdir -p /var/log/openvswitch\n\n# if another process is listening on the cni-server socket, wait until it exits\ntrap 'kill $(jobs -p); exit 0' TERM\nretries=0\nwhile true; do\n  if /usr/share/openvswitch/scripts/ovs-ctl status \u0026\u003e/dev/null; then\n    echo \"warning: Another process is currently managing OVS, waiting 15s ...\" 2\u003e\u00261\n    sleep 15 \u0026 wait\n    (( retries += 1 ))\n  else\n    break\n  fi\n  if [[ \"${retries}\" -gt 40 ]]; then\n    echo \"error: Another process is currently managing OVS, exiting\" 2\u003e\u00261\n    exit 1\n  fi\ndone\n\n# launch OVS\nfunction quit {\n    /usr/share/openvswitch/scripts/ovs-ctl stop\n    exit 0\n}\ntrap quit SIGTERM\n/usr/share/openvswitch/scripts/ovs-ctl start --no-ovs-vswitchd --system-id=random\n\n# Restrict the number of pthreads ovs-vswitchd creates to reduce the\n# amount of RSS it uses on hosts with many cores\n# https://bugzilla.redhat.com/show_bug.cgi?id=1571379\n# https://bugzilla.redhat.com/show_bug.cgi?id=1572797\nif [[ `nproc` -gt 12 ]]; then\n    ovs-vsctl --no-wait set Open_vSwitch . other_config:n-revalidator-threads=4\n    ovs-vsctl --no-wait set Open_vSwitch . other_config:n-handler-threads=10\nfi\n/usr/share/openvswitch/scripts/ovs-ctl start --no-ovsdb-server --system-id=random\n\ntail --follow=name /var/log/openvswitch/ovs-vswitchd.log /var/log/openvswitch/ovsdb-server.log \u0026\nsleep 20\nwhile true; do\n  if ! /usr/share/openvswitch/scripts/ovs-ctl status \u0026\u003e/dev/null; then\n    echo \"OVS seems to have crashed, exiting\"\n    quit\n  fi\n  sleep 15\ndone\n"],"resources":{"requests":{"cpu":"100m","memory":"300Mi"}},"volumeMounts":[{"name":"host-modules","readOnly":true,"mountPath":"/lib/modules"},{"name":"host-run-ovs","mountPath":"/run/openvswitch"},{"name":"host-run-ovs","mountPath":"/var/run/openvswitch"},{"name":"host-sys","readOnly":true,"mountPath":"/sys"},{"name":"host-config-openvswitch","mountPath":"/etc/openvswitch"},{"name":"log-openvswitch","mountPath":"/var/log/openvswitch-old"}],"livenessProbe":{"exec":{"command":["/usr/share/openvswitch/scripts/ovs-ctl","status"]},"initialDelaySeconds":15,"timeoutSeconds":1,"periodSeconds":5,"successThreshold":1,"failureThreshold":3},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"IfNotPresent","securityContext":{"privileged":true,"runAsUser":0}}],"restartPolicy":"Always","terminationGracePeriodSeconds":30,"dnsPolicy":"ClusterFirst","serviceAccountName":"sdn","serviceAccount":"sdn","hostNetwork":true,"hostPID":true,"securityContext":{},"schedulerName":"default-scheduler","tolerations":[{"operator":"Exists"}],"priorityClassName":"system-node-critical"}},"updateStrategy":{"type":"OnDelete"},"templateGeneration":2,"revisionHistoryLimit":10},"status":{"currentNumberScheduled":1,"numberMisscheduled":0,"desiredNumberScheduled":1,"numberReady":1,"observedGeneration":2,"updatedNumberScheduled":1,"numberAvailable":1}}
